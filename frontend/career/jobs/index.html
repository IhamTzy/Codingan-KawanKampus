<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Detail Lowongan | KawanKampus</title>
  <meta name="description" content="Temukan detail lowongan karier kampus terbaru di KawanKampus.">
  <link rel="icon" href="../../assets/img/logo kk1.jpg">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Roboto:wght@300;400;500;700&display=swap"
    rel="stylesheet">

  <!-- Vendor CSS -->
  <link href="../../assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="../../assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">

  <!-- Main CSS -->
  <link href="../../assets/css/main.css" rel="stylesheet">

  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: #f4f7fb;
    }

    header {
      background: #ffffff;
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    }

    .job-hero {
      background: linear-gradient(135deg, rgba(23, 111, 242, 0.09), rgba(248, 249, 252, 0));
      padding: 48px 0 24px;
    }

    .job-card {
      background: #ffffff;
      border-radius: 20px;
      box-shadow: 0 20px 45px rgba(15, 23, 42, 0.08);
      overflow: hidden;
    }

    .job-poster {
      border-radius: 16px;
      width: 100%;
      height: auto;
      object-fit: cover;
    }

    .badge-soft {
      background: rgba(23, 111, 242, 0.09);
      color: #176ff2;
      padding: 8px 14px;
      border-radius: 999px;
      font-weight: 500;
      margin-right: 8px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .skill-pill {
      background: rgba(15, 23, 42, 0.08);
      border-radius: 999px;
      padding: 6px 14px;
      font-size: 0.9rem;
      margin: 4px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .skill-pill span {
      font-size: 0.8rem;
      color: rgba(15, 23, 42, 0.55);
    }

    .deadline-chip {
      background: rgba(255, 165, 0, 0.18);
      color: #a66300;
      border-radius: 999px;
      padding: 8px 16px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-weight: 500;
    }

    .apply-card {
      background: #0f172a;
      color: #fff;
      border-radius: 18px;
      padding: 24px;
    }

    .apply-card a {
      color: #fff;
      text-decoration: underline;
    }
  </style>
</head>

<body>
  <header class="py-3">
    <div class="container d-flex justify-content-between align-items-center">
      <a href="../../index.html" class="d-flex align-items-center text-decoration-none">
        <img src="../../assets/img/logo kk1.jpg" alt="KawanKampus" width="36" height="36"
          class="rounded-circle me-3">
        <span class="fw-semibold text-dark">KawanKampus</span>
      </a>
      <a href="https://kawankampus.id/" class="btn btn-outline-primary btn-sm">
        Download Aplikasi
      </a>
    </div>
  </header>

  <main>
    <section class="job-hero">
      <div class="container">
        <div id="loading" class="text-center py-5">
          <div class="spinner-border text-primary" role="status"></div>
          <p class="mt-3 mb-0 text-muted">Memuat data lowongan...</p>
        </div>
        <div id="error-box" class="alert alert-danger d-none" role="alert"></div>

        <div id="job-container" class="job-card p-4 p-lg-5 d-none">
          <div class="row g-4">
            <div class="col-lg-8">
              <div class="d-flex flex-wrap align-items-center gap-2 mb-3">
                <span id="employment-badge" class="badge-soft"></span>
                <span id="location-badge" class="badge-soft"></span>
                <span id="remote-badge" class="badge-soft d-none"><i class="bi bi-wifi"></i>Remote</span>
              </div>
              <h1 id="job-title" class="fw-bold mb-3"></h1>
              <p id="company-info" class="text-muted mb-4"></p>
              <div id="company-info-section" class="mb-4 d-none">
                <h2 class="h6 fw-semibold mb-2">Tentang Perusahaan</h2>
                <p id="company-description" class="text-secondary lh-lg mb-0"></p>
              </div>
              <div id="deadline-chip" class="deadline-chip mb-4 d-inline-flex">
                <i class="bi bi-calendar-event"></i>
                <span id="deadline-text"></span>
              </div>
              <div class="mb-5">
                <h2 class="h5 fw-semibold mb-3">Deskripsi Pekerjaan</h2>
                <div id="job-description" class="text-secondary lh-lg"></div>
              </div>
              <div class="mb-4">
                <h3 class="h6 fw-semibold mb-3">Jurusan yang Dicari</h3>
                <div id="job-majors" class="text-secondary"></div>
              </div>
              <div>
                <h3 class="h6 fw-semibold mb-3">Keahlian yang Dibutuhkan</h3>
                <div id="job-skills"></div>
              </div>
            </div>

            <div class="col-lg-4">
              <div class="mb-4">
                <img id="poster" src="" alt="Poster Lowongan" class="job-poster d-none">
              </div>
              <div class="apply-card mb-4">
                <h3 class="h6 fw-semibold mb-3">Tertarik dengan lowongan ini?</h3>
                <p class="mb-4">Unduh aplikasi KawanKampus untuk melamar lebih mudah, simpan lowongan favorit, dan dapatkan rekomendasi karier lainnya.</p>
                <div class="d-grid gap-2">
                  <a href="https://play.google.com/store/apps/details?id=id.kawankampus.app" target="_blank"
                    rel="noopener" class="btn btn-light btn-sm fw-semibold">Download di Google Play</a>
                  <a href="https://apps.apple.com/id/app/kawankampus/id6451436792" target="_blank" rel="noopener"
                    class="btn btn-outline-light btn-sm fw-semibold">Download di App Store</a>
                </div>
              </div>
              <div class="card border-0 shadow-sm">
                <div class="card-body">
                  <h3 class="h6 fw-semibold mb-3">Rincian</h3>
                  <ul class="list-unstyled text-secondary small mb-0">
                    <li class="mb-2"><i class="bi bi-geo-alt me-2"></i><span id="job-location"></span></li>
                    <li class="mb-2"><i class="bi bi-clock-history me-2"></i><span id="job-duration"></span></li>
                    <li><i class="bi bi-building me-2"></i><span id="job-company-location"></span></li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </section>
  </main>

  <footer class="py-4 bg-white border-top">
    <div class="container text-center text-muted small">
      &copy; <span id="year"></span> KawanKampus. Semua hak dilindungi.
    </div>
  </footer>

  <script>
    const yearEl = document.getElementById('year');
    if (yearEl) {
      yearEl.textContent = new Date().getFullYear();
    }

    const pathSegments = window.location.pathname.split('/').filter(Boolean);
    const jobId = pathSegments[pathSegments.length - 1];

    const loadingEl = document.getElementById('loading');
    const errorEl = document.getElementById('error-box');
    const containerEl = document.getElementById('job-container');

    if (!jobId || Number.isNaN(Number(jobId))) {
      showError('ID lowongan tidak valid.');
    } else {
      loadJob(jobId);
    }

    function apiBaseUrl() {
      if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
        return 'http://localhost:8080';
      }
      if (window.location.hostname.startsWith('dev.')) {
        return `https://${window.location.hostname.replace('dev.', 'api.')}`;
      }
      return 'https://api.kawankampus.id';
    }

    async function loadJob(id) {
      try {
        const response = await fetch(`${apiBaseUrl()}/api/career/jobs/${encodeURIComponent(id)}`);
        if (!response.ok) {
          if (response.status === 404) {
            throw new Error('Lowongan tidak ditemukan atau sudah tidak tersedia.');
          }
          throw new Error('Gagal memuat data lowongan. Silakan coba beberapa saat lagi.');
        }
        const data = await response.json();
        renderJob(data);
      } catch (error) {
        showError(error.message);
      } finally {
        loadingEl.classList.add('d-none');
      }
    }

    function renderJob(data) {
      const titleEl = document.getElementById('job-title');
      const companyInfoEl = document.getElementById('company-info');
      const descriptionEl = document.getElementById('job-description');
      const majorsEl = document.getElementById('job-majors');
      const skillsEl = document.getElementById('job-skills');
      const employmentBadge = document.getElementById('employment-badge');
      const locationBadge = document.getElementById('location-badge');
      const remoteBadge = document.getElementById('remote-badge');
      const deadlineChip = document.getElementById('deadline-chip');
      const deadlineText = document.getElementById('deadline-text');
      const posterEl = document.getElementById('poster');
      const jobLocationEl = document.getElementById('job-location');
      const jobDurationEl = document.getElementById('job-duration');
      const companyLocationEl = document.getElementById('job-company-location');
      const companyDescription = data['companyDescription']?.toString() ?? '';
      const companyInfoSection = document.getElementById('company-info-section');
      const companyDescriptionEl = document.getElementById('company-description');

      titleEl.textContent = data.title ?? 'Lowongan Tanpa Judul';

      const companyParts = [];
      if (data.companyName) companyParts.push(data.companyName);
      if (data.companyIndustry) companyParts.push(data.companyIndustry);
      if (data.companyWebsite) {
        companyParts.push(`<a href="${normalizeWebsite(data.companyWebsite)}" target="_blank" rel="noopener">Kunjungi Website</a>`);
      }
      companyInfoEl.innerHTML = companyParts.join(' &bull; ');
      if (companyDescription.trim().length > 0) {
        companyDescriptionEl.textContent = companyDescription;
        companyInfoSection.classList.remove('d-none');
      } else {
        companyInfoSection.classList.add('d-none');
      }

      employmentBadge.textContent = formatEnum(data.employmentType);
      locationBadge.textContent = formatEnum(data.locationType);
      if (data.remoteAllowed) {
        remoteBadge.classList.remove('d-none');
      }

      if (data.applicationDeadline) {
        const deadlineDate = new Date(data.applicationDeadline);
        deadlineText.textContent = new Intl.DateTimeFormat('id-ID', {
          day: 'numeric',
          month: 'long',
          year: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        }).format(deadlineDate);
      } else {
        deadlineChip.classList.add('d-none');
      }

      descriptionEl.innerHTML = data.description
        ? data.description.split('\n').map(line => line.trim()).filter(Boolean).map(line => `<p>${line}</p>`).join('')
        : '<p class="text-muted">Deskripsi belum tersedia.</p>';

      if (Array.isArray(data.majors) && data.majors.length) {
        majorsEl.innerHTML = data.majors.map(major => `<span class="badge bg-light text-dark me-2 mb-2">${major}</span>`).join('');
      } else {
        majorsEl.innerHTML = '<span class="text-muted">Tidak ada informasi jurusan khusus.</span>';
      }

      if (Array.isArray(data.skills) && data.skills.length) {
        skillsEl.innerHTML = data.skills.map(skill => {
          return `<span class="skill-pill">${skill.name}<span>${formatEnum(skill.importance)}</span></span>`;
        }).join('');
      } else {
        skillsEl.innerHTML = '<span class="text-muted">Tidak ada keahlian khusus yang disebutkan.</span>';
      }

      if (data.posterUrl) {
        posterEl.src = toAbsoluteUrl(data.posterUrl);
        posterEl.classList.remove('d-none');
      }

      jobLocationEl.textContent = buildLocationText(data);
      jobDurationEl.textContent = buildDurationText(data.minDurationWeeks, data.maxDurationWeeks);
      companyLocationEl.textContent = buildCompanyLocation(data);

      containerEl.classList.remove('d-none');
    }

    function buildLocationText(data) {
      const parts = [];
      if (data.city) parts.push(data.city);
      if (data.country && data.country !== data.city) parts.push(data.country);
      if (!parts.length) {
        return data.remoteAllowed ? 'Bisa bekerja secara remote' : 'Lokasi akan diinformasikan kemudian';
      }
      return parts.join(', ');
    }

    function buildCompanyLocation(data) {
      const parts = [];
      if (data.companyCity) parts.push(data.companyCity);
      if (data.companyCountry && data.companyCountry !== data.companyCity) {
        parts.push(data.companyCountry);
      }
      return parts.length ? parts.join(', ') : 'Lokasi perusahaan belum tersedia';
    }

    function buildDurationText(minWeeks, maxWeeks) {
      if (!minWeeks && !maxWeeks) {
        return 'Durasi belum diinformasikan';
      }
      if (minWeeks && maxWeeks) {
        return `${minWeeks} - ${maxWeeks} minggu`;
      }
      if (minWeeks) {
        return `Minimal ${minWeeks} minggu`;
      }
      return `Maksimal ${maxWeeks} minggu`;
    }

    function formatEnum(value) {
      if (!value) return '-';
      return value.replace(/_/g, ' ').toLowerCase().replace(/\b\w/g, c => c.toUpperCase());
    }

    function normalizeWebsite(url) {
      if (!url) return '#';
      if (url.startsWith('http://') || url.startsWith('https://')) {
        return url;
      }
      return `https://${url}`;
    }

    function toAbsoluteUrl(path) {
      if (!path) return '';
      if (path.startsWith('http://') || path.startsWith('https://')) {
        return path;
      }
      if (path.startsWith('/')) {
        return `${apiBaseUrl()}${path}`;
      }
      return `${apiBaseUrl()}/${path}`;
    }

    function showError(message) {
      loadingEl.classList.add('d-none');
      errorEl.textContent = message;
      errorEl.classList.remove('d-none');
    }
  </script>
</body>

</html>
